{"ast":null,"code":"import { BufferGeometry, Color, Float32BufferAttribute, Vector2, Vector3 } from '../../../build/three.module.js';\n/**\n * Break faces with edges longer than maxEdgeLength\n */\n\nvar TessellateModifier = function (maxEdgeLength = 0.1, maxIterations = 6) {\n  this.maxEdgeLength = maxEdgeLength;\n  this.maxIterations = maxIterations;\n};\n\nTessellateModifier.prototype.modify = function (geometry) {\n  if (geometry.isGeometry === true) {\n    console.error('THREE.TessellateModifier no longer supports Geometry. Use BufferGeometry instead.');\n    return geometry;\n  }\n\n  if (geometry.index !== null) {\n    geometry = geometry.toNonIndexed();\n  } //\n\n\n  const maxIterations = this.maxIterations;\n  const maxEdgeLengthSquared = this.maxEdgeLength * this.maxEdgeLength;\n  const va = new Vector3();\n  const vb = new Vector3();\n  const vc = new Vector3();\n  const vm = new Vector3();\n  const vs = [va, vb, vc, vm];\n  const na = new Vector3();\n  const nb = new Vector3();\n  const nc = new Vector3();\n  const nm = new Vector3();\n  const ns = [na, nb, nc, nm];\n  const ca = new Color();\n  const cb = new Color();\n  const cc = new Color();\n  const cm = new Color();\n  const cs = [ca, cb, cc, cm];\n  const ua = new Vector2();\n  const ub = new Vector2();\n  const uc = new Vector2();\n  const um = new Vector2();\n  const us = [ua, ub, uc, um];\n  const u2a = new Vector2();\n  const u2b = new Vector2();\n  const u2c = new Vector2();\n  const u2m = new Vector2();\n  const u2s = [u2a, u2b, u2c, u2m];\n  const attributes = geometry.attributes;\n  const hasNormals = attributes.normal !== undefined;\n  const hasColors = attributes.color !== undefined;\n  const hasUVs = attributes.uv !== undefined;\n  const hasUV2s = attributes.uv2 !== undefined;\n  let positions = attributes.position.array;\n  let normals = hasNormals ? attributes.normal.array : null;\n  let colors = hasColors ? attributes.color.array : null;\n  let uvs = hasUVs ? attributes.uv.array : null;\n  let uv2s = hasUV2s ? attributes.uv2.array : null;\n  let positions2 = positions;\n  let normals2 = normals;\n  let colors2 = colors;\n  let uvs2 = uvs;\n  let uv2s2 = uv2s;\n  let iteration = 0;\n  let tessellating = true;\n\n  function addTriangle(a, b, c) {\n    const v1 = vs[a];\n    const v2 = vs[b];\n    const v3 = vs[c];\n    positions2.push(v1.x, v1.y, v1.z);\n    positions2.push(v2.x, v2.y, v2.z);\n    positions2.push(v3.x, v3.y, v3.z);\n\n    if (hasNormals) {\n      const n1 = ns[a];\n      const n2 = ns[b];\n      const n3 = ns[c];\n      normals2.push(n1.x, n1.y, n1.z);\n      normals2.push(n2.x, n2.y, n2.z);\n      normals2.push(n3.x, n3.y, n3.z);\n    }\n\n    if (hasColors) {\n      const c1 = cs[a];\n      const c2 = cs[b];\n      const c3 = cs[c];\n      colors2.push(c1.x, c1.y, c1.z);\n      colors2.push(c2.x, c2.y, c2.z);\n      colors2.push(c3.x, c3.y, c3.z);\n    }\n\n    if (hasUVs) {\n      const u1 = us[a];\n      const u2 = us[b];\n      const u3 = us[c];\n      uvs2.push(u1.x, u1.y);\n      uvs2.push(u2.x, u2.y);\n      uvs2.push(u3.x, u3.y);\n    }\n\n    if (hasUV2s) {\n      const u21 = u2s[a];\n      const u22 = u2s[b];\n      const u23 = u2s[c];\n      uv2s2.push(u21.x, u21.y);\n      uv2s2.push(u22.x, u22.y);\n      uv2s2.push(u23.x, u23.y);\n    }\n  }\n\n  while (tessellating && iteration < maxIterations) {\n    iteration++;\n    tessellating = false;\n    positions = positions2;\n    positions2 = [];\n\n    if (hasNormals) {\n      normals = normals2;\n      normals2 = [];\n    }\n\n    if (hasColors) {\n      colors = colors2;\n      colors2 = [];\n    }\n\n    if (hasUVs) {\n      uvs = uvs2;\n      uvs2 = [];\n    }\n\n    if (hasUV2s) {\n      uv2s = uv2s2;\n      uv2s2 = [];\n    }\n\n    for (var i = 0, i2 = 0, il = positions.length; i < il; i += 9, i2 += 6) {\n      va.fromArray(positions, i + 0);\n      vb.fromArray(positions, i + 3);\n      vc.fromArray(positions, i + 6);\n\n      if (hasNormals) {\n        na.fromArray(normals, i + 0);\n        nb.fromArray(normals, i + 3);\n        nc.fromArray(normals, i + 6);\n      }\n\n      if (hasColors) {\n        ca.fromArray(colors, i + 0);\n        cb.fromArray(colors, i + 3);\n        cc.fromArray(colors, i + 6);\n      }\n\n      if (hasUVs) {\n        ua.fromArray(uvs, i2 + 0);\n        ub.fromArray(uvs, i2 + 2);\n        uc.fromArray(uvs, i2 + 4);\n      }\n\n      if (hasUV2s) {\n        u2a.fromArray(uv2s, i2 + 0);\n        u2b.fromArray(uv2s, i2 + 2);\n        u2c.fromArray(uv2s, i2 + 4);\n      }\n\n      const dab = va.distanceToSquared(vb);\n      const dbc = vb.distanceToSquared(vc);\n      const dac = va.distanceToSquared(vc);\n\n      if (dab > maxEdgeLengthSquared || dbc > maxEdgeLengthSquared || dac > maxEdgeLengthSquared) {\n        tessellating = true;\n\n        if (dab >= dbc && dab >= dac) {\n          vm.lerpVectors(va, vb, 0.5);\n          if (hasNormals) nm.lerpVectors(na, nb, 0.5);\n          if (hasColors) cm.lerpColors(ca, cb, 0.5);\n          if (hasUVs) um.lerpVectors(ua, ub, 0.5);\n          if (hasUV2s) u2m.lerpVectors(u2a, u2b, 0.5);\n          addTriangle(0, 3, 2);\n          addTriangle(3, 1, 2);\n        } else if (dbc >= dab && dbc >= dac) {\n          vm.lerpVectors(vb, vc, 0.5);\n          if (hasNormals) nm.lerpVectors(nb, nc, 0.5);\n          if (hasColors) cm.lerpColors(cb, cc, 0.5);\n          if (hasUVs) um.lerpVectors(ub, uc, 0.5);\n          if (hasUV2s) u2m.lerpVectors(u2b, u2c, 0.5);\n          addTriangle(0, 1, 3);\n          addTriangle(3, 2, 0);\n        } else {\n          vm.lerpVectors(va, vc, 0.5);\n          if (hasNormals) nm.lerpVectors(na, nc, 0.5);\n          if (hasColors) cm.lerpColors(ca, cc, 0.5);\n          if (hasUVs) um.lerpVectors(ua, uc, 0.5);\n          if (hasUV2s) u2m.lerpVectors(u2a, u2c, 0.5);\n          addTriangle(0, 1, 3);\n          addTriangle(3, 1, 2);\n        }\n      } else {\n        addTriangle(0, 1, 2);\n      }\n    }\n  }\n\n  const geometry2 = new BufferGeometry();\n  geometry2.setAttribute('position', new Float32BufferAttribute(positions2, 3));\n\n  if (hasNormals) {\n    geometry2.setAttribute('normal', new Float32BufferAttribute(normals2, 3));\n  }\n\n  if (hasColors) {\n    geometry2.setAttribute('color', new Float32BufferAttribute(colors2, 3));\n  }\n\n  if (hasUVs) {\n    geometry2.setAttribute('uv', new Float32BufferAttribute(uvs2, 2));\n  }\n\n  if (hasUV2s) {\n    geometry2.setAttribute('uv2', new Float32BufferAttribute(uv2s2, 2));\n  }\n\n  return geometry2;\n};\n\nexport { TessellateModifier };","map":{"version":3,"sources":["D:/AA_CLASS/COURS GOBELINS DMII1/ARTISANAT/artisanat-gobelins-vercel/app/node_modules/three/examples/jsm/modifiers/TessellateModifier.js"],"names":["BufferGeometry","Color","Float32BufferAttribute","Vector2","Vector3","TessellateModifier","maxEdgeLength","maxIterations","prototype","modify","geometry","isGeometry","console","error","index","toNonIndexed","maxEdgeLengthSquared","va","vb","vc","vm","vs","na","nb","nc","nm","ns","ca","cb","cc","cm","cs","ua","ub","uc","um","us","u2a","u2b","u2c","u2m","u2s","attributes","hasNormals","normal","undefined","hasColors","color","hasUVs","uv","hasUV2s","uv2","positions","position","array","normals","colors","uvs","uv2s","positions2","normals2","colors2","uvs2","uv2s2","iteration","tessellating","addTriangle","a","b","c","v1","v2","v3","push","x","y","z","n1","n2","n3","c1","c2","c3","u1","u2","u3","u21","u22","u23","i","i2","il","length","fromArray","dab","distanceToSquared","dbc","dac","lerpVectors","lerpColors","geometry2","setAttribute"],"mappings":"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","sourcesContent":["import {\n\tBufferGeometry,\n\tColor,\n\tFloat32BufferAttribute,\n\tVector2,\n\tVector3\n} from '../../../build/three.module.js';\n\n/**\n * Break faces with edges longer than maxEdgeLength\n */\n\nvar TessellateModifier = function ( maxEdgeLength = 0.1, maxIterations = 6 ) {\n\n\tthis.maxEdgeLength = maxEdgeLength;\n\tthis.maxIterations = maxIterations;\n\n};\n\nTessellateModifier.prototype.modify = function ( geometry ) {\n\n\tif ( geometry.isGeometry === true ) {\n\n\t\tconsole.error( 'THREE.TessellateModifier no longer supports Geometry. Use BufferGeometry instead.' );\n\t\treturn geometry;\n\n\t}\n\n\tif ( geometry.index !== null ) {\n\n\t\tgeometry = geometry.toNonIndexed();\n\n\t}\n\n\t//\n\n\tconst maxIterations = this.maxIterations;\n\tconst maxEdgeLengthSquared = this.maxEdgeLength * this.maxEdgeLength;\n\n\tconst va = new Vector3();\n\tconst vb = new Vector3();\n\tconst vc = new Vector3();\n\tconst vm = new Vector3();\n\tconst vs = [ va, vb, vc, vm ];\n\n\tconst na = new Vector3();\n\tconst nb = new Vector3();\n\tconst nc = new Vector3();\n\tconst nm = new Vector3();\n\tconst ns = [ na, nb, nc, nm ];\n\n\tconst ca = new Color();\n\tconst cb = new Color();\n\tconst cc = new Color();\n\tconst cm = new Color();\n\tconst cs = [ ca, cb, cc, cm ];\n\n\tconst ua = new Vector2();\n\tconst ub = new Vector2();\n\tconst uc = new Vector2();\n\tconst um = new Vector2();\n\tconst us = [ ua, ub, uc, um ];\n\n\tconst u2a = new Vector2();\n\tconst u2b = new Vector2();\n\tconst u2c = new Vector2();\n\tconst u2m = new Vector2();\n\tconst u2s = [ u2a, u2b, u2c, u2m ];\n\n\tconst attributes = geometry.attributes;\n\tconst hasNormals = attributes.normal !== undefined;\n\tconst hasColors = attributes.color !== undefined;\n\tconst hasUVs = attributes.uv !== undefined;\n\tconst hasUV2s = attributes.uv2 !== undefined;\n\n\tlet positions = attributes.position.array;\n\tlet normals = hasNormals ? attributes.normal.array : null;\n\tlet colors = hasColors ? attributes.color.array : null;\n\tlet uvs = hasUVs ? attributes.uv.array : null;\n\tlet uv2s = hasUV2s ? attributes.uv2.array : null;\n\n\tlet positions2 = positions;\n\tlet normals2 = normals;\n\tlet colors2 = colors;\n\tlet uvs2 = uvs;\n\tlet uv2s2 = uv2s;\n\n\tlet iteration = 0;\n\tlet tessellating = true;\n\n\tfunction addTriangle( a, b, c ) {\n\n\t\tconst v1 = vs[ a ];\n\t\tconst v2 = vs[ b ];\n\t\tconst v3 = vs[ c ];\n\n\t\tpositions2.push( v1.x, v1.y, v1.z );\n\t\tpositions2.push( v2.x, v2.y, v2.z );\n\t\tpositions2.push( v3.x, v3.y, v3.z );\n\n\t\tif ( hasNormals ) {\n\n\t\t\tconst n1 = ns[ a ];\n\t\t\tconst n2 = ns[ b ];\n\t\t\tconst n3 = ns[ c ];\n\n\t\t\tnormals2.push( n1.x, n1.y, n1.z );\n\t\t\tnormals2.push( n2.x, n2.y, n2.z );\n\t\t\tnormals2.push( n3.x, n3.y, n3.z );\n\n\t\t}\n\n\t\tif ( hasColors ) {\n\n\t\t\tconst c1 = cs[ a ];\n\t\t\tconst c2 = cs[ b ];\n\t\t\tconst c3 = cs[ c ];\n\n\t\t\tcolors2.push( c1.x, c1.y, c1.z );\n\t\t\tcolors2.push( c2.x, c2.y, c2.z );\n\t\t\tcolors2.push( c3.x, c3.y, c3.z );\n\n\t\t}\n\n\t\tif ( hasUVs ) {\n\n\t\t\tconst u1 = us[ a ];\n\t\t\tconst u2 = us[ b ];\n\t\t\tconst u3 = us[ c ];\n\n\t\t\tuvs2.push( u1.x, u1.y );\n\t\t\tuvs2.push( u2.x, u2.y );\n\t\t\tuvs2.push( u3.x, u3.y );\n\n\t\t}\n\n\t\tif ( hasUV2s ) {\n\n\t\t\tconst u21 = u2s[ a ];\n\t\t\tconst u22 = u2s[ b ];\n\t\t\tconst u23 = u2s[ c ];\n\n\t\t\tuv2s2.push( u21.x, u21.y );\n\t\t\tuv2s2.push( u22.x, u22.y );\n\t\t\tuv2s2.push( u23.x, u23.y );\n\n\t\t}\n\n\t}\n\n\twhile ( tessellating && iteration < maxIterations ) {\n\n\t\titeration ++;\n\t\ttessellating = false;\n\n\t\tpositions = positions2;\n\t\tpositions2 = [];\n\n\t\tif ( hasNormals ) {\n\n\t\t\tnormals = normals2;\n\t\t\tnormals2 = [];\n\n\t\t}\n\n\t\tif ( hasColors ) {\n\n\t\t\tcolors = colors2;\n\t\t\tcolors2 = [];\n\n\t\t}\n\n\t\tif ( hasUVs ) {\n\n\t\t\tuvs = uvs2;\n\t\t\tuvs2 = [];\n\n\t\t}\n\n\t\tif ( hasUV2s ) {\n\n\t\t\tuv2s = uv2s2;\n\t\t\tuv2s2 = [];\n\n\t\t}\n\n\t\tfor ( var i = 0, i2 = 0, il = positions.length; i < il; i += 9, i2 += 6 ) {\n\n\t\t\tva.fromArray( positions, i + 0 );\n\t\t\tvb.fromArray( positions, i + 3 );\n\t\t\tvc.fromArray( positions, i + 6 );\n\n\t\t\tif ( hasNormals ) {\n\n\t\t\t\tna.fromArray( normals, i + 0 );\n\t\t\t\tnb.fromArray( normals, i + 3 );\n\t\t\t\tnc.fromArray( normals, i + 6 );\n\n\t\t\t}\n\n\t\t\tif ( hasColors ) {\n\n\t\t\t\tca.fromArray( colors, i + 0 );\n\t\t\t\tcb.fromArray( colors, i + 3 );\n\t\t\t\tcc.fromArray( colors, i + 6 );\n\n\t\t\t}\n\n\t\t\tif ( hasUVs ) {\n\n\t\t\t\tua.fromArray( uvs, i2 + 0 );\n\t\t\t\tub.fromArray( uvs, i2 + 2 );\n\t\t\t\tuc.fromArray( uvs, i2 + 4 );\n\n\t\t\t}\n\n\t\t\tif ( hasUV2s ) {\n\n\t\t\t\tu2a.fromArray( uv2s, i2 + 0 );\n\t\t\t\tu2b.fromArray( uv2s, i2 + 2 );\n\t\t\t\tu2c.fromArray( uv2s, i2 + 4 );\n\n\t\t\t}\n\n\t\t\tconst dab = va.distanceToSquared( vb );\n\t\t\tconst dbc = vb.distanceToSquared( vc );\n\t\t\tconst dac = va.distanceToSquared( vc );\n\n\t\t\tif ( dab > maxEdgeLengthSquared || dbc > maxEdgeLengthSquared || dac > maxEdgeLengthSquared ) {\n\n\t\t\t\ttessellating = true;\n\n\t\t\t\tif ( dab >= dbc && dab >= dac ) {\n\n\t\t\t\t\tvm.lerpVectors( va, vb, 0.5 );\n\t\t\t\t\tif ( hasNormals ) nm.lerpVectors( na, nb, 0.5 );\n\t\t\t\t\tif ( hasColors ) cm.lerpColors( ca, cb, 0.5 );\n\t\t\t\t\tif ( hasUVs ) um.lerpVectors( ua, ub, 0.5 );\n\t\t\t\t\tif ( hasUV2s ) u2m.lerpVectors( u2a, u2b, 0.5 );\n\n\t\t\t\t\taddTriangle( 0, 3, 2 );\n\t\t\t\t\taddTriangle( 3, 1, 2 );\n\n\t\t\t\t} else if ( dbc >= dab && dbc >= dac ) {\n\n\t\t\t\t\tvm.lerpVectors( vb, vc, 0.5 );\n\t\t\t\t\tif ( hasNormals ) nm.lerpVectors( nb, nc, 0.5 );\n\t\t\t\t\tif ( hasColors ) cm.lerpColors( cb, cc, 0.5 );\n\t\t\t\t\tif ( hasUVs ) um.lerpVectors( ub, uc, 0.5 );\n\t\t\t\t\tif ( hasUV2s ) u2m.lerpVectors( u2b, u2c, 0.5 );\n\n\t\t\t\t\taddTriangle( 0, 1, 3 );\n\t\t\t\t\taddTriangle( 3, 2, 0 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tvm.lerpVectors( va, vc, 0.5 );\n\t\t\t\t\tif ( hasNormals ) nm.lerpVectors( na, nc, 0.5 );\n\t\t\t\t\tif ( hasColors ) cm.lerpColors( ca, cc, 0.5 );\n\t\t\t\t\tif ( hasUVs ) um.lerpVectors( ua, uc, 0.5 );\n\t\t\t\t\tif ( hasUV2s ) u2m.lerpVectors( u2a, u2c, 0.5 );\n\n\t\t\t\t\taddTriangle( 0, 1, 3 );\n\t\t\t\t\taddTriangle( 3, 1, 2 );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\taddTriangle( 0, 1, 2 );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tconst geometry2 = new BufferGeometry();\n\n\tgeometry2.setAttribute( 'position', new Float32BufferAttribute( positions2, 3 ) );\n\n\tif ( hasNormals ) {\n\n\t\tgeometry2.setAttribute( 'normal', new Float32BufferAttribute( normals2, 3 ) );\n\n\t}\n\n\tif ( hasColors ) {\n\n\t\tgeometry2.setAttribute( 'color', new Float32BufferAttribute( colors2, 3 ) );\n\n\t}\n\n\tif ( hasUVs ) {\n\n\t\tgeometry2.setAttribute( 'uv', new Float32BufferAttribute( uvs2, 2 ) );\n\n\t}\n\n\tif ( hasUV2s ) {\n\n\t\tgeometry2.setAttribute( 'uv2', new Float32BufferAttribute( uv2s2, 2 ) );\n\n\t}\n\n\treturn geometry2;\n\n};\n\nexport { TessellateModifier };\n"]},"metadata":{},"sourceType":"module"}